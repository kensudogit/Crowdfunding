# Railway デプロイチェックリスト

このチェックリストを使用して、Railwayへのデプロイを段階的に確認してください。

## ✅ 事前準備

- [ ] Railwayアカウントを作成済み
- [ ] GitHubリポジトリにコードがプッシュ済み
- [ ] ローカルでDocker環境が動作することを確認済み

## 📦 ステップ1: プロジェクトとデータベース

- [ ] Railwayプロジェクトを作成
- [ ] PostgreSQLデータベースを追加
- [ ] データベースサービス名をメモ（通常は `Postgres`）

## 🔧 ステップ2: バックエンドデプロイ

### サービス設定
- [ ] バックエンドサービスを作成
- [ ] Root Directory: `backend` に設定
- [ ] Dockerfile Path: `Dockerfile.prod` に設定

### 環境変数設定
- [ ] `NODE_ENV=production`
- [ ] `PORT=8000`
- [ ] `DB_HOST=${{Postgres.PGHOST}}` （サービス名を確認）
- [ ] `DB_PORT=${{Postgres.PGPORT}}`
- [ ] `DB_NAME=${{Postgres.PGDATABASE}}`
- [ ] `DB_USER=${{Postgres.PGUSER}}`
- [ ] `DB_PASSWORD=${{Postgres.PGPASSWORD}}`
- [ ] `JWT_SECRET=<強力なランダム文字列>` （32文字以上）
- [ ] `FRONTEND_URL=<一時的に localhost:3000 でも可>`
- [ ] `CORS_ORIGIN=<一時的に localhost:3000 でも可>`

### デプロイ確認
- [ ] デプロイが完了した
- [ ] デプロイログにエラーがない
- [ ] バックエンドのURLをコピーした

### 動作確認
- [ ] `https://<バックエンドURL>/api/health` にアクセスして正常に応答する
- [ ] `https://<バックエンドURL>/` にアクセスしてAPI情報が表示される

## 🎨 ステップ3: フロントエンドデプロイ

### サービス設定
- [ ] フロントエンドサービスを作成
- [ ] Root Directory: `frontend` に設定
- [ ] Dockerfile Path: `Dockerfile.prod` に設定

### 環境変数設定
- [ ] `VITE_API_URL=https://<バックエンドのURL>/api` （バックエンドURLを設定）

### デプロイ確認
- [ ] デプロイが完了した
- [ ] デプロイログにエラーがない
- [ ] フロントエンドのURLをコピーした

### 動作確認
- [ ] `https://<フロントエンドURL>` にアクセスしてアプリケーションが表示される

## 🔄 ステップ4: CORS設定の更新

- [ ] バックエンドの `FRONTEND_URL` をフロントエンドのURLに更新
- [ ] バックエンドの `CORS_ORIGIN` をフロントエンドのURLに更新
- [ ] 再デプロイが完了した

## 💾 ステップ5: データベース初期化

- [ ] データベースを初期化した
  - [ ] 方法1: APIエンドポイント `/api/sample-data/generate` にアクセス
  - [ ] 方法2: Railway CLIでSQLファイルを実行
  - [ ] 方法3: pgAdmin/psqlでSQLファイルを実行

### データベース確認
- [ ] ユーザーテーブルが作成された
- [ ] プロジェクトテーブルが作成された
- [ ] サンプルデータが投入された（オプション）

## 🧪 ステップ6: 機能テスト

### 認証機能
- [ ] ユーザー登録が動作する
- [ ] ログインが動作する
- [ ] ログアウトが動作する

### プロジェクト機能
- [ ] プロジェクト一覧が表示される
- [ ] プロジェクト詳細が表示される
- [ ] プロジェクト作成が動作する（ログイン後）

### API接続
- [ ] フロントエンドからバックエンドAPIに接続できる
- [ ] CORSエラーが発生しない
- [ ] ネットワークエラーが発生しない

## 🌐 ステップ7: カスタムドメイン（オプション）

- [ ] バックエンドにカスタムドメインを設定
- [ ] フロントエンドにカスタムドメインを設定
- [ ] DNS設定を完了
- [ ] DNS設定が反映された（数分〜数時間）

## 📊 最終確認

- [ ] すべてのサービスが正常に動作している
- [ ] データベース接続が正常
- [ ] APIが正常に応答
- [ ] フロントエンドが正常に表示
- [ ] エラーログがない

## 🎉 デプロイ完了！

すべてのチェック項目が完了したら、デプロイは成功です。

フロントエンドのURLを共有して、アプリケーションを公開できます。

## 📝 メモ

### バックエンドURL
```
https://
```

### フロントエンドURL
```
https://
```

### JWT_SECRET
```
（安全に保管してください）
```

### カスタムドメイン（設定した場合）
- バックエンド: `https://`
- フロントエンド: `https://`
